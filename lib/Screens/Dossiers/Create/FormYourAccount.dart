import 'package:circular_countdown_timer/circular_countdown_timer.dart';
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:date_time_picker/date_time_picker.dart';
import 'package:dropdown_search/dropdown_search.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'package:flutter/material.dart';
import 'package:plan_de_financement/Screens/Client/Dashboard/FormTableauDeBoardScreen.dart';
import 'package:plan_de_financement/Screens/WidgetHelper/ButtonWidgetHelper.dart';
import 'package:plan_de_financement/Screens/WidgetHelper/TextFieldWidget2.dart';

import 'package:provider/provider.dart';

import 'package:plan_de_financement/Provider/Provider_StateManagemant.dart';
import 'package:shared_preferences/shared_preferences.dart';
import 'package:syncfusion_flutter_charts/charts.dart';

class FormYourAccount extends StatefulWidget {
  const FormYourAccount({Key key}) : super(key: key);

  @override
  _FormYourAccountState createState() => _FormYourAccountState();
}

class _FormYourAccountState extends State<FormYourAccount> {
  double widthTextField = 600;
  List<int> list = [5, 10, 15, 20, 25];

  TextEditingController nomController = TextEditingController(text: "");
  TextEditingController prenomController = TextEditingController(text: "");
  TextEditingController adressDuBienController =
      TextEditingController(text: "");
  TextEditingController villeDuBienController = TextEditingController(text: "");
  TextEditingController adresseEmailController =
      TextEditingController(text: "");
  TextEditingController numeroTelController = TextEditingController(text: "");

  TextEditingController validatinSmsController =
      TextEditingController(text: '');

  bool isWaiting = false;
  

  @override
  void initState() {
    final model = Provider.of<ProviderSM>(context, listen: false);

    nomController.text = model.informationClient['NOM_CREATION'];
    prenomController.text = model.informationClient['PRENOM_CREATION'];
    adressDuBienController.text =
        model.informationClient['ADRESSE_DU_BIEN_CREATION'];
    villeDuBienController.text =
        model.informationClient['VILLE_DU_BIEN_CREATION'];
    adresseEmailController.text =
        model.informationClient['ADRESSE_MAIL_CREATION'];
    numeroTelController.text =
        model.informationClient['NUMERO_DE_TELEPHONE_PORTABLE_CREATION'];

    super.initState();
  }

  bool isSignUp = false;
  bool isSignIn = false;

  bool isNumberPhoneInVerification = false;

  ConfirmationResult confirmationResult;

  @override
  Widget build(BuildContext context) {
    // var conditionResponive = (MediaQuery.of(context).size.width >= 1024);
    var model = Provider.of<ProviderSM>(context);

    return Form(
      key: model.formKey,
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.center,
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          /// forme signup
          Visibility(
            visible: !isNumberPhoneInVerification,
            child: Column(
              children: [
                Padding(
                  padding: const EdgeInsets.all(8.0),
                  child: TextFieldHelper2(
                      width: widthTextField,
                      controller: nomController,
                      labelField: "NOM",
                      validator: model.validatorTextFieldString,
                      isText: true,
                      onChanged: (val) {
                        model.informationClient["NOM_CREATION"] = val;
                      }),
                ),
                Padding(
                  padding: const EdgeInsets.all(8.0),
                  child: TextFieldHelper2(
                      width: widthTextField,
                      controller: prenomController,
                      labelField: "PRENOM",
                      validator: model.validatorTextFieldString,
                      isText: true,
                      onChanged: (val) {
                        model.informationClient["PRENOM_CREATION"] = val;
                      }),
                ),
                Padding(
                  padding: const EdgeInsets.all(8.0),
                  child: TextFieldHelper2(
                      width: widthTextField,
                      controller: adressDuBienController,
                      labelField: "ADRESSE DU BIEN",
                      validator: model.validatorTextFieldString,
                      isText: true,
                      onChanged: (val) {
                        model.informationClient["ADRESSE_DU_BIEN_CREATION"] =
                            val;
                      }),
                ),
                Padding(
                  padding: const EdgeInsets.all(8.0),
                  child: TextFieldHelper2(
                      width: widthTextField,
                      controller: villeDuBienController,
                      labelField: "VILLE DU BIEN",
                      isText: true,
                      validator: model.validatorTextFieldString,
                      onChanged: (val) {
                        model.informationClient["VILLE_DU_BIEN_CREATION"] = val;
                      }),
                ),
                Padding(
                  padding: const EdgeInsets.all(8.0),
                  child: TextFieldHelper2(
                      width: widthTextField,
                      controller: adresseEmailController,
                      labelField: "ADRESSE MAIL",
                      isText: true,
                      validator: model.validatorTextFieldString,
                      onChanged: (val) {
                        model.informationClient["ADRESSE_MAIL_CREATION"] = val;
                      }),
                ),
                Padding(
                  padding: const EdgeInsets.all(8.0),
                  child: TextFieldHelper2(
                      width: widthTextField,
                      controller: numeroTelController,
                      labelField: "TELEPHONE PORTABLE",
                      hintText: '+33611223344',
                      validator: model.validatorTextFieldString,
                      isText: true,
                      onChanged: (val) {
                        model.informationClient[
                            "NUMERO_DE_TELEPHONE_PORTABLE_CREATION"] = val;
                      }),
                ),
              ],
            ),
          ),

          Visibility(
            visible: isNumberPhoneInVerification,
            child: Column(
              mainAxisAlignment: MainAxisAlignment.center,
              crossAxisAlignment: CrossAxisAlignment.center,
              children: [
                Padding(
                  padding: const EdgeInsets.all(8.0),
                  child: TextFieldHelper2(
                    onChanged: (e) {},
                    width: widthTextField,
                    controller: validatinSmsController,
                    labelField: "VÃ©rification sms",
                    validator: model.validatorTextFieldTelephone,
                    isDouble: true,
                  ),
                ),
                Visibility(
                  visible: !isWaiting,
                  child: ButtonWidgetHelper(
                    width: 200,
                    height: 40.0,
                    onTap: () async {
                      try {
                        print('================= this si resend');
                        FirebaseAuth auth = FirebaseAuth.instance;

                        String numberPhone = (model.informationClient[
                            "NUMERO_DE_TELEPHONE_PORTABLE_CREATION"]);

                        confirmationResult =
                            await auth.signInWithPhoneNumber(numberPhone,RecaptchaVerifier(
  container: 'recaptcha',
  size: RecaptchaVerifierSize.compact,
  
  theme: RecaptchaVerifierTheme.dark,
) );


                        setState(() {
                          isWaiting = true;
                        });
                      } catch (e) {
                        print(e);
                        print('err');
                      }
                    },
                    textButton: "   Renvoyer un SMS",
                    icon: Container(),
                  ),
          
                ),
                Visibility(
                  visible: isWaiting,
                  child: Row(
                    mainAxisAlignment: MainAxisAlignment.center,
                    crossAxisAlignment: CrossAxisAlignment.center,
                    children: [
                      Padding(
                        padding: const EdgeInsets.only(
                            left: 20, right: 20, top: 10, bottom: 10),
                        child: CircularCountDownTimer(
                          duration: 10,
                          initialDuration: 0,
                          width: 30,
                          height: 30,
                          ringColor: Colors.grey[300],
                          ringGradient: null,
                          fillColor: Colors.greenAccent[100],
                          fillGradient: null,
                          backgroundColor: Colors.green[500],
                          backgroundGradient: null,
                          strokeWidth: 10.0,
                          strokeCap: StrokeCap.round,
                          textStyle: TextStyle(
                              fontSize: 13.0,
                              color: Colors.white,
                              fontWeight: FontWeight.bold),
                          textFormat: CountdownTextFormat.S,
                          isReverse: false,
                          isReverseAnimation: false,
                          isTimerTextShown: true,
                          autoStart: true,
                          onComplete: () {
                            setState(() => isWaiting = false);
                          },
                        ),
                      ),
                      Text('Renvoyer un code SMS...')
                    ],
                  ),
                ),
                SizedBox(height: 20)
              ],
            ),
          ),



          Visibility(
            visible: !isNumberPhoneInVerification,
            child: Container(
                width: widthTextField,
                child: Column(
                  children: [
                    Text(
                      "WWW.SEVENDREASOIMEME.COM dÃ©clare respecter les dispositions de la loi Informatique et LibertÃ©s du 6 janvier 1978 modifiÃ©e par la loi du 6 aoÃ»t 2004 et dÃ©clarent respecter tous les textes lÃ©gaux et rÃ©glementaires en vigueur. WWW.SEVENDREASOIMEME.COM s'engage de surcroÃ®t Ã  rÃ©aliser toutes les formalitÃ©s administratives et lÃ©gales qui pourraient leur incomber au cours de la rÃ©alisation du prÃ©sent accord et notamment toute dÃ©claration auprÃ¨s de la Commission Nationale Informatique et LibertÃ©s. ",
                      style: TextStyle(fontSize: 12),
                    ),
                    Align(
                      alignment: Alignment.centerLeft,
                      child: Text(
                        "En tant quâintermÃ©diaire en opÃ©rations bancaires, SEVENDREASOIMEME CREDIT est tenue de collecter des donnÃ©es personnelles relatives Ã  des personnes physiques. En effet, lâintermÃ©diaire doit recueillir auprÃ¨s du CLIENT, y compris du CLIENT potentiel, des informations relatives Ã  ses ressources et Ã  ses charges ainsi quâaux prÃªts en cours quâil a contractÃ©s, permettant Ã  lâÃ©tablissement de crÃ©dit de vÃ©rifier sa solvabilitÃ© (article R. 519-21 du Code de la consommation). Constituent des donnÃ©es personnelles Â« toute information relative Ã  une personne physique identifiÃ©e ou qui peut Ãªtre identifiÃ©e, directement ou indirectement, par rÃ©fÃ©rence Ã  un numÃ©ro dâidentification ou Ã  un ou plusieurs Ã©lÃ©ments qui lui sont propres Â». WWW.SEVENDREASOIMEME.COM met en Åuvre les moyens nÃ©cessaires Ã  la protection de la vie privÃ©e des internautes, de ses prospects et de ses clients, ainsi que de leurs donnÃ©es Ã  caractÃ¨re personnel. WWW.SEVENDREASOIMEME.COM collecte et utilise les donnÃ©es personnelles de maniÃ¨re loyale et licite. Les donnÃ©es personnelles sont collectÃ©es pour des finalitÃ©s dÃ©terminÃ©es, explicites et lÃ©gitimes et ne sont pas traitÃ©es ultÃ©rieurement de maniÃ¨re incompatible avec ces finalitÃ©s. WWW.SEVENDREASOIMEME.COM propose des services reposant sur lâanalyse de donnÃ©es personnelles. La communication volontaire de donnÃ©es personnelles permet Ã  WWW.SEVENDREASOIMEME.COM de proposer des contrats adaptÃ©s aux besoins des CLIENTs ou prospects et de remplir ses obligations lÃ©gales. WWW.SEVENDREASOIMEME.COM ne procÃ¨de Ã  aucun enregistrement des communications tÃ©lÃ©phoniques.",
                        style: TextStyle(fontSize: 12),
                        textAlign: TextAlign.start,
                      ),
                    ),
                    Align(
                      alignment: Alignment.centerLeft,
                      child: Text(
                        "WWW.SEVENDREASOIMEME.COM s'engage, conformÃ©ment aux articles 34 et 35 de la loi du 6 janvier 1978 modifiÃ©e relative Ã  l'informatique, aux fichiers et aux libertÃ©s ainsi qu'aux articles 32 Ã  35 du rÃ¨glement gÃ©nÃ©ral sur la protection des donnÃ©es (RGPD) du 27 avril 2016, Ã  prendre toutes prÃ©cautions conformes aux usages dans le cadre de ses attributions afin de protÃ©ger la confidentialitÃ© des informations auxquelles il aura accÃ¨s, et en particulier d'empÃªcher qu'elles ne soient communiquÃ©es Ã  des personnes non expressÃ©ment autorisÃ©es Ã  recevoir ces informations.",
                        style: TextStyle(fontSize: 12),
                        textAlign: TextAlign.start,
                      ),
                    ),
                    Align(
                      alignment: Alignment.centerLeft,
                      child: Text(
                        " WWW.SEVENDREASOIMEME.COM s'engage notamment Ã  : \n  Ne pas utiliser les donnÃ©es auxquelles il peut accÃ©der Ã  des fins autres que celles prÃ©vues par ses attributions ; \n  Ne divulguer ces donnÃ©es qu'aux personnes dÃ»ment autorisÃ©es, en raison de leurs fonctions, Ã  en recevoir communication, qu'il s'agisse de personnes privÃ©es, publiques, physiques ou morales ; \n  Ne faire aucune copie de ces donnÃ©es sauf Ã  ce que cela soit nÃ©cessaire Ã  l'exÃ©cution de ses fonctions ; \n  Prendre toutes les mesures conformes aux usages dans le cadre de ses attributions afin d'Ã©viter l'utilisation dÃ©tournÃ©e ou frauduleuse de ces donnÃ©es ; \n  Prendre toutes prÃ©cautions conformes aux usages pour prÃ©server la sÃ©curitÃ© physique et logique de ces donnÃ©es ;  \n  S'assurer, dans la limite de ses attributions, que seuls des moyens de communication sÃ©curisÃ©s seront utilisÃ©s pour transfÃ©rer ces donnÃ©es ; \n  En cas de cessation de ses fonctions, restituer intÃ©gralement les donnÃ©es, fichiers informatiques et tout support d'information relatif Ã  ces donnÃ©es.  Cet engagement de confidentialitÃ©, en vigueur pendant toute la durÃ©e de leur relation, demeurera effectif, sans limitation de durÃ©e aprÃ¨s la cessation de ses fonctions, quelle qu'en soit la cause, dÃ¨s lors que cet engagement concerne l'utilisation et la communication de donnÃ©es Ã  caractÃ¨re personnel.",
                        style: TextStyle(fontSize: 12),
                        textAlign: TextAlign.start,
                      ),
                    ),
                    Align(
                      alignment: Alignment.centerLeft,
                      child: Text(
                        "WWW.SEVENDREASOIMEME.COM pourra Ãªtre amenÃ© Ã  traiter pour le compte de son cocontractant des donnÃ©es Ã  caractÃ¨re personnel afin de satisfaire aux obligations lÃ©gales et rÃ©glementaires et, pour les traitements et le suivi des prestations Ã  effectuer, la gestion marketing, la relation client et le recouvrement. WWW.SEVENDREASOIMEME.COM pourra traiter Ã  lâintÃ©rieur de son groupe incluant les sociÃ©tÃ©s SEVENDREASOIMEME CREDIT, SEVENDREASOIMEME IMMOBILIER, SEVENDREASOIMEME GESTION et SEVENDREASOIMEME CONSEIL, Ã  lâexclusion de tous autres tiers, les donnÃ©es personnelles de ses cocontractants incluant  ses nom, prÃ©nom, tÃ©lÃ©phone, e-mail, adresse, et autres donnÃ©es liÃ©es au CLIENT en relation avec les activitÃ©s de WWW.SEVENDREASOIMEME.COM, incluant ses donnÃ©es patrimoniales, bancaires et fiscales. Ces donnÃ©es seront traitÃ©es exclusivement pour les finalitÃ©s indiquÃ©es ci-dessus, de maniÃ¨re pertinente et proportionnÃ©e, et pour une durÃ©e maximum de CINQ (5) ans aprÃ¨s lâexpiration des contrats en cours. Exceptionnellement, les donnÃ©es personnelles peuvent Ãªtre conservÃ©es une fois ces finalitÃ©s accomplies pendant la durÃ©e des finalitÃ©s annoncÃ©es majorÃ©e du dÃ©lai de prescription, afin notamment de traiter une rÃ©clamation, de rÃ©pondre aux besoins dâune action en justice probable ou en cours ou encore sur demande des autoritÃ©s administratives de supervision. En cas dâincident de paiement, elles pourront Ãªtre transmises Ã  une sociÃ©tÃ© de recouvrement. WWW.SEVENDREASOIMEME.COM ne procÃ¨de Ã  aucun profilage des donnÃ©es Ã  caractÃ¨re personnel.",
                        style: TextStyle(fontSize: 12),
                        textAlign: TextAlign.start,
                      ),
                    ),
                    Align(
                      alignment: Alignment.centerLeft,
                      child: Text(
                        "WWW.SEVENDREASOIMEME.COM met en place les mesures appropriÃ©es de sÃ©curitÃ©, tant techniques que dâorganisation afin de protÃ©ger les donnÃ©es personnelles de ses cocontractants contre toute destruction accidentelle ou illÃ©gale, contre toute perte ou altÃ©ration et contre toute, intrusion, rÃ©vÃ©lation non autorisÃ©e ou tout traitement contraire aux dispositions de la lÃ©gislation relative Ã  la Protection des DonnÃ©es. WWW.SEVENDREASOIMEME.COM se conformera Ã  toutes demandes et instructions raisonnables et appropriÃ©es du cocontractant permettant Ã  ce dernier de vÃ©rifier la conformitÃ© avec la lÃ©gislation sur la Protection des DonnÃ©es. WWW.SEVENDREASOIMEME.COM sâassure que les employÃ©s qui traitent les donnÃ©es personnelles en son nom sont tenus par une obligation de confidentialitÃ© couvrant lâensemble des donnÃ©es personnelles traitÃ©es dans le cadre de leur relation contractuelle. Lâobligation de confidentialitÃ© persiste mÃªme Ã  lâissue de leur relation contractuelle. Les donnÃ©es personnelles sont couvertes par le secret professionnel. Les professionnels ayant accÃ¨s aux donnÃ©es personnelles reÃ§oivent des formations relativement au cadre juridique de leur utilisation.",
                        style: TextStyle(fontSize: 12),
                        textAlign: TextAlign.start,
                      ),
                    ),
                    Align(
                      alignment: Alignment.centerLeft,
                      child: Text(
                        "WWW.SEVENDREASOIMEME.COM peut sous-traiter son activitÃ© et, par consÃ©quent, les opÃ©rations de traitement de donnÃ©es qui en dÃ©coulent Ã  un tiers. Dans ce cas, le contrat conclu avec le sous-traitant devra expressÃ©ment prÃ©voir les mÃªmes obligations au sous-traitant que celles pesant sur WWW.SEVENDREASOIMEME.COM",
                        style: TextStyle(fontSize: 12),
                        textAlign: TextAlign.start,
                      ),
                    ),
                    Align(
                      alignment: Alignment.centerLeft,
                      child: Text(
                        "WWW.SEVENDREASOIMEME.COM notifie sans dÃ©lai Ã  ses cocontractants tout cas de violation avÃ©rÃ©e ou potentielle de donnÃ©es Ã  caractÃ¨re personnel traitÃ©es en application du contrat.",
                        style: TextStyle(fontSize: 12),
                        textAlign: TextAlign.start,
                      ),
                    ),
                    Align(
                      alignment: Alignment.centerLeft,
                      child: Text(
                        "WWW.SEVENDREASOIMEME.COM sâengage Ã  retourner tous documents et supports contenant des donnÃ©es personnelles ou, sur demande de ses cocontractants Ã  effacer les donnÃ©es personnelles.",
                        style: TextStyle(fontSize: 12),
                        textAlign: TextAlign.start,
                      ),
                    ),
                    Align(
                      alignment: Alignment.centerLeft,
                      child: Text(
                        "WWW.SEVENDREASOIMEME.COM respecte les droits des personnes en ce que ses cocontractants peuvent Ã  tout moment retirer son consentement gratuitement et sans justification, exercer son droit dâaccÃ¨s, de rectification et dâeffacement des donnÃ©es le concernant ou obtenir des informations supplÃ©mentaires sur les donnÃ©es personnelles conservÃ©es et traitÃ©es par WWW.SEVENDREASOIMEME.COM en contactant le Responsable des DonnÃ©es Personnelles Â« Data Protection Officer (DPO) Â» Ã  lâadresse : 66 avenue des Champs-ElysÃ©es Bureau 46 (75008) PARIS. ModalitÃ©s dâexercice des droits : envoyer votre demande par courrier RAR avec copie dâune piÃ¨ce dâidentitÃ© valide. ",
                        style: TextStyle(fontSize: 12),
                        textAlign: TextAlign.start,
                      ),
                    ),
                    Align(
                      alignment: Alignment.centerLeft,
                      child: Text(
                        "La rÃ©clamation est traitÃ©e dans les dÃ©lais suivants : envoi dâun accusÃ© de rÃ©ception dans un dÃ©lai de 10 jours ouvrables suivi dâun envoi dâune rÃ©ponse circonstanciÃ©e avant Ã©chÃ©ance dâun dÃ©lai de deux mois suivant la rÃ©ception des piÃ¨ces justificatives nÃ©cessaires. En cas de circonstance particuliÃ¨re empÃªchant le bon traitement de la rÃ©clamation dans les dÃ©lais mentionnÃ©s, WWW.SEVENDREASOIMEME.COM sâengage Ã  tenir le CLIENT informÃ©. Le titulaire des droits peut saisir la CNIL (cnil.fr) si la rÃ©ponse donnÃ©e ne lui est pas satisfaisante. ",
                        style: TextStyle(fontSize: 12),
                        textAlign: TextAlign.start,
                      ),
                    ),
                    Align(
                      alignment: Alignment.centerLeft,
                      child: Text(
                        "Tout CLIENT de WWW.SEVENDREASOIMEME.COM et visiteur de dispose de droits quant Ã  ses donnÃ©es personnelles : dâaccÃ¨s, de rectification, dâopposition et de suppression des donnÃ©es nominatives personnelles les concernant (article 34 de la Loi nÂ° 78-17 du 6 janvier 1978 relative Ã  lâinformatique, aux fichiers et aux libertÃ©s, modifiÃ©e par la Loi 2018-493 du 20 juin 2018). En particulier, lâutilisateur du site, de mÃªme que chaque CLIENT, dispose du droit de sâopposer sans frais Ã  lâutilisation de ses donnÃ©es personnelles Ã  des fins de prospection. Les principaux droits que chaque personne peut exercer relativement Ã  ses donnÃ©es personnelles sont les suivants : * Droit dâopposition : toute personne peut demander que ses donnÃ©es personnelles ne soient plus utilisÃ©es par un traitement informatique ; * Droit dâaccÃ¨s et de rectification : toute personne peut accÃ©der Ã  ses donnÃ©es personnelles et demander la rectification de certaines informations. Les donnÃ©es collectÃ©es dans le cadre dâun traitement relatif Ã  la Lutte Contre le Blanchiment et contre le Financement du Terrorisme font lâobjet dâun droit dâaccÃ¨s indirect, par contact avec la CNIL : lien vers le site de la CNIL ; * Droit Ã  lâeffacement (ou Ã  lâoubli) : lorsque la durÃ©e de conservation des donnÃ©es personnelles est Ã©coulÃ©e, toute personne peut demander leur effacement, sous rÃ©serve des dispositions de lâarticle 40 II de la Loi nÂ°78-17 du 6 janvier 1978, modifiÃ©e ; * Droit Ã  la limitation des traitements : si les donnÃ©es ne sont plus nÃ©cessaires, toute personne peut demander quâelles soient moins utilisÃ©es ; * Droit Ã  la portabilitÃ© : toute personne peut demander quâune copie de ses donnÃ©es personnelles lui soit remise ou soit remise Ã  la personne de son choix, clairement dÃ©signÃ©e par elle ; * Droit de retirer le consentement dâutilisation : toute personne peut retirer son consentement Ã  lâutilisation des donnÃ©es nÃ©cessitant un consentement explicite initial, telles que les donnÃ©es utilisÃ©es Ã  des fins commerciales ; * Droit de fixer le sort des donnÃ©es aprÃ¨s la mort : toute personne peut confier des directives Ã  une personne choisie par ses soins, en vue de fixer la conservation, la communication ou lâeffacement de ses donnÃ©es personnelles aprÃ¨s sa mort. ",
                        style: TextStyle(fontSize: 12),
                        textAlign: TextAlign.start,
                      ),
                    ),
                    Align(
                      alignment: Alignment.centerLeft,
                      child: Text(
                        "En cas de rÃ©clamation dâune autre nature relativement au traitement de donnÃ©es personnelles, les cocontractants de WWW.SEVENDREASOIMEME.COM peuvent Ã©galement contacter la Commission Nationale Informatique et LibertÃ©s (CNIL : cnil.fr). ",
                        style: TextStyle(fontSize: 12),
                        textAlign: TextAlign.start,
                      ),
                    ),
                    Align(
                      alignment: Alignment.centerLeft,
                      child: Text(
                        "La validation de la demande implique la lecture et la parfaite comprÃ©hension du prÃ©sent avertissement ainsi que lâadhÃ©sion sans rÃ©serves Ã  la politique de gestion des donnÃ©es personnelles du groupe SEVENDREASOIMEME",
                        style: TextStyle(fontSize: 12),
                        textAlign: TextAlign.start,
                      ),
                    ),
                  ],
                )),
          ),

          Row(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              InkWell(
                customBorder: RoundedRectangleBorder(
                  borderRadius: BorderRadius.circular(20),
                ),
                onTap: () {
                  model.returnSteppe();
                },
                child: Container(
                  width: 100,
                  height: 40.0,
                  child: Center(
                    child: Wrap(
                      children: [
                        Text(
                          'Retour',
                          style: TextStyle(
                            fontSize: 15.0,
                            color: Color(0xFF3a6259),
                          ),
                        ),
                      ],
                    ),
                  ),
                ),
              ),
              ButtonWidgetHelper(
                width: isNumberPhoneInVerification ? 140 : 320,
                height: 40.0,
                onTap: () async {
                  if (isNumberPhoneInVerification) {
                    try {
                      UserCredential userCredential = await confirmationResult
                          .confirm(validatinSmsController.text);

                      model.informationClient['uidClient'] = userCredential.user.uid;

                      model.nextSteppe();

                      print(userCredential);
                    } catch (e) {
                      ScaffoldMessenger.of(context).showSnackBar(SnackBar(
                          content: Text("Le code de sms est incorrect")));
                    }

                    return;
                  }

                  if (model.formKey.currentState.validate()) {
                    try {
                      FirebaseAuth auth = FirebaseAuth.instance;

                      String numberPhone = (model.informationClient[
                          "NUMERO_DE_TELEPHONE_PORTABLE_CREATION"]);

                      // Wait for the user to complete the reCAPTCHA & for an SMS code to be sent.
                      confirmationResult =
                          await auth.signInWithPhoneNumber(numberPhone);

                      setState(() {
                        isNumberPhoneInVerification = true;
                        isWaiting = true;
                      });
                    } catch (e) {


                      ScaffoldMessenger.of(context).showSnackBar(SnackBar(
                          content: Text(
                              "une erreur s'est produite, veuillez vÃ©rifier votre numÃ©ro de tÃ©lÃ©phone")));
                    }
                  }

                  // model.nextSteppe();
                },
                textButton: isNumberPhoneInVerification
                    ? "   Suivant"
                    : "   Obtenir le prÃ©visionnel pluriannuel",
                icon: Container(),
              ),
            ],
          ),
        ],
      ),
    );
  }
}
